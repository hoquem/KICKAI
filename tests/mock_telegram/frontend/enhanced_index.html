<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Mock Telegram Tester</title>
    <style>
        :root {
            /* Primary Colors */
            --primary-blue: #1a73e8;
            --primary-green: #34a853;
            --primary-red: #ea4335;
            --primary-yellow: #fbbc04;
            
            /* Status Colors */
            --status-online: #34a853;
            --status-offline: #ea4335;
            --status-warning: #fbbc04;
            
            /* User Role Colors */
            --role-player: #4285f4;
            --role-admin: #ea4335;
            --role-leadership: #fbbc04;
            --role-member: #34a853;
            
            /* Neutral Colors */
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e8eaed;
            --text-primary: #202124;
            --text-secondary: #5f6368;
            --border-color: #dadce0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: var(--bg-primary);
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }
        
        .header h1 {
            color: var(--primary-blue);
            margin-bottom: 8px;
            font-size: 28px;
        }
        
        .header p {
            color: var(--text-secondary);
            font-size: 16px;
        }
        
        .team-info {
            background: var(--bg-tertiary);
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 12px;
            border-left: 4px solid var(--primary-blue);
        }
        
        .team-info .team-id {
            font-weight: 600;
            color: var(--primary-blue);
            font-size: 14px;
        }
        
        .team-info .team-source {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        
        /* Data source styling */
        .team-source.firestore {
            color: #28a745 !important;
            font-weight: bold;
        }
        
        .team-source.mock-fallback {
            color: #ffc107 !important;
            font-weight: bold;
        }
        
        .team-source.mock-only {
            color: #dc3545 !important;
            font-weight: bold;
        }
        
        .team-source.error {
            color: #dc3545 !important;
            font-weight: bold;
        }
        
        .team-source.unknown {
            color: #6c757d !important;
            font-weight: bold;
        }
        
        .team-switcher {
            margin-top: 12px;
        }
        
        .team-switcher select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
        }
        
        .team-switcher select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }
        
        .team-switcher label {
            display: block;
            margin-bottom: 6px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 24px;
        }
        
        .sidebar {
            background: var(--bg-primary);
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            height: fit-content;
        }
        
        .chat-area {
            background: var(--bg-primary);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            height: 700px;
        }
        
        .chat-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
            border-radius: 12px 12px 0 0;
        }
        
        .chat-messages {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            background: var(--bg-secondary);
        }
        
        .message {
            margin-bottom: 16px;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 75%;
            word-wrap: break-word;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .message.user {
            background: var(--primary-blue);
            color: white;
            margin-left: auto;
        }
        
        .message.bot {
            background: var(--bg-secondary);
            border-left: 4px solid var(--primary-blue);
            margin-left: 20px;
        }
        
        .message-content {
            line-height: 1.5;
            word-wrap: break-word;
        }
        
        .message-content code {
            background: #f0f0f0;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .message-content strong {
            font-weight: 600;
        }
        
        .message-content br {
            margin-bottom: 4px;
        }
        
        .message-info {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 6px;
            font-weight: 500;
        }
        
        .chat-input {
            padding: 20px 24px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: 0 0 12px 12px;
        }
        
        .input-group {
            display: flex;
            gap: 12px;
        }
        
        .input-group input {
            flex: 1;
            padding: 14px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }
        
        .input-group button {
            padding: 14px 24px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s;
        }
        
        .input-group button:hover {
            background: #1557b0;
        }
        
        .input-group button:disabled {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            cursor: not-allowed;
        }
        
        /* System Status */
        .system-status {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            font-size: 14px;
        }
        
        .status-value {
            font-weight: 500;
        }
        
        .status-value.online {
            color: var(--status-online);
        }
        
        .status-value.offline {
            color: var(--status-offline);
        }
        
        /* User Selection */
        .user-selection {
            margin-bottom: 24px;
        }
        
        .user-categories {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .category-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .category-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }
        
        .user-search {
            margin-bottom: 16px;
        }
        
        .user-search input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
        }
        
        .user-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
        
        .user-item {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-item:last-child {
            border-bottom: none;
        }
        
        .user-item:hover {
            background: var(--bg-secondary);
        }
        
        .user-item.active {
            background: #e3f2fd;
            border-left: 4px solid var(--primary-blue);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
            font-size: 16px;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-weight: 500;
            margin-bottom: 4px;
            color: var(--text-primary);
        }
        
        .user-role {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .user-phone {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        
        .user-permissions {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }
        
        .permission-badge {
            padding: 2px 6px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            font-size: 10px;
            color: var(--text-secondary);
        }
        
        .permission-badge.main-chat {
            background: #e8f5e8;
            color: var(--primary-green);
        }
        
        .permission-badge.leadership-chat {
            background: #fff3e0;
            color: var(--primary-yellow);
        }
        
        /* Chat Selection */
        .chat-selection {
            margin-bottom: 24px;
        }
        
        .chat-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .chat-tab {
            padding: 10px 16px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .chat-tab.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }
        
        .chat-tab.disabled {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .chat-context {
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 6px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Test Templates */
        .test-templates {
            margin-bottom: 24px;
        }
        
        .test-templates h4 {
            margin-bottom: 12px;
            color: var(--text-primary);
        }
        
        .template-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .template-btn {
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            text-align: left;
            transition: all 0.2s;
        }
        
        .template-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--primary-blue);
        }
        
        /* Message Controls */
        .message-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }
        
        .message-search {
            flex: 1;
            display: flex;
            gap: 8px;
        }
        
        .message-search input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
        }
        
        .search-btn {
            padding: 8px 12px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .message-filters select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
        }
        
        .message-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .action-btn:hover {
            background: var(--bg-secondary);
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
                margin-top: 20px;
            }
            
            .chat-area {
                order: 1;
            }
            
            .system-status {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }
            
            .template-buttons {
                grid-template-columns: 1fr;
            }
            
            .message-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
                    <div class="header">
                <h1>🤖 Enhanced Mock Telegram Tester</h1>
                <p>Test your KICKAI bot system with real Firebase user data</p>
                <div class="team-info">
                    <div class="team-id">Team ID: <span id="currentTeamId">Loading...</span></div>
                    <div class="team-source">Source: <span id="teamSource">Loading...</span></div>
                    <div class="team-switcher">
                        <label for="teamSelector">Switch Team:</label>
                        <select id="teamSelector">
                            <option value="">Loading teams...</option>
                        </select>
                    </div>
                </div>
            </div>
        
        <div class="main-content">
            <div class="sidebar">
                <!-- System Status -->
                <div class="system-status">
                    <div class="status-item">
                        <span class="status-icon">🤖</span>
                        <span class="status-label">Bot</span>
                        <span class="status-value" id="botStatus">Checking...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-icon">🔥</span>
                        <span class="status-label">Firebase</span>
                        <span class="status-value" id="firebaseStatus">Checking...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-icon">🧠</span>
                        <span class="status-label">AI Provider</span>
                        <span class="status-value" id="aiProvider">Hugging Face</span>
                    </div>
                </div>
                
                <!-- User Selection -->
                <div class="user-selection">
                    <h3>👥 Firebase Users</h3>
                    <div class="user-categories">
                        <button class="category-btn active" data-category="all">All</button>
                        <button class="category-btn" data-category="players">Players</button>
                        <button class="category-btn" data-category="team-members">Team Members</button>
                        <button class="category-btn" data-category="admins">Admins</button>
                    </div>
                    
                    <div class="user-search">
                        <input type="text" placeholder="Search users..." id="userSearch">
                    </div>
                    
                    <div class="user-list" id="userList">
                        <div style="padding: 20px; text-align: center; color: var(--text-secondary);">
                            Loading Firebase users...
                        </div>
                    </div>
                </div>
                
                <!-- Chat Selection -->
                <div class="chat-selection">
                    <h3>💬 Select Chat</h3>
                    <div class="chat-tabs">
                        <button class="chat-tab active" data-chat="main">
                            🏠 Main Chat
                        </button>
                        <button class="chat-tab" data-chat="leadership">
                            👑 Leadership
                        </button>
                        <button class="chat-tab" data-chat="private">
                            💬 Private
                        </button>
                    </div>
                    
                    <div class="chat-context">
                        <p class="chat-description">Main team chat for all players</p>
                        <p class="chat-permissions">All users can send messages</p>
                    </div>
                </div>
                
                <!-- Test Templates -->
                <div class="test-templates">
                    <h4>🚀 Quick Test Scenarios</h4>
                    <div class="template-buttons">
                        <button class="template-btn" data-scenario="player-registration">
                            🏃 Add New Player
                        </button>
                        <button class="template-btn" data-scenario="match-creation">
                            ⚽ Create Match
                        </button>
                        <button class="template-btn" data-scenario="attendance-marking">
                            ✅ Mark Attendance
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="chat-area">
                <div class="chat-header">
                    <h3 id="chatTitle">Select a user to start chatting</h3>
                </div>
                
                <!-- Message Controls -->
                <div class="message-controls">
                    <div class="message-search">
                        <input type="text" placeholder="Search messages..." id="messageSearch">
                        <button class="search-btn">🔍</button>
                    </div>
                    
                    <div class="message-filters">
                        <select id="messageTypeFilter">
                            <option value="all">All Messages</option>
                            <option value="commands">Commands Only</option>
                            <option value="bot-responses">Bot Responses</option>
                            <option value="user-messages">User Messages</option>
                        </select>
                    </div>
                    
                    <div class="message-actions">
                        <button class="action-btn" id="exportBtn">📤 Export</button>
                        <button class="action-btn" id="clearBtn">🗑️ Clear</button>
                    </div>
                </div>
                
                <div id="chatMessages" class="chat-messages">
                    <div class="message bot">
                        <div class="message-info">🤖 KickAI Bot</div>
                        Welcome to the Enhanced Mock Telegram Tester! Select a Firebase user from the sidebar to start testing with real data.
                    </div>
                </div>
                
                <div class="chat-input">
                    <div class="input-group">
                        <input 
                            type="text" 
                            id="messageInput" 
                            placeholder="Select a user first..."
                            disabled
                        >
                        <button disabled id="sendButton">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application Constants (Fail-Fast Configuration)
        const CONFIG = {
            // Network configuration
            API: {
                DEFAULT_HOST: 'localhost',
                DEFAULT_PORT: 8001,
                BASE_PATH: '/api',
                WS_PATH: '/ws'
            },
            
            // Timeout configuration (in milliseconds)
            TIMEOUTS: {
                HTTP_REQUEST: 30000,       // 30 seconds
                WS_CONNECT: 10000,         // 10 seconds
                WS_MESSAGE: 5000,          // 5 seconds
                WS_RECONNECT: 5000         // 5 seconds
            },
            
            // Status messages
            STATUS: {
                ONLINE: 'Online',
                OFFLINE: 'Offline',
                ERROR: 'Error',
                CHECKING: 'Checking...',
                CONNECTED: 'Connected',
                DISCONNECTED: 'Disconnected'
            },
            
            // UI Configuration
            UI: {
                SEARCH_DEBOUNCE: 300,      // milliseconds
                MAX_MESSAGE_LENGTH: 4096,   // characters
                RECONNECT_ATTEMPTS: 3
            }
        };
        
        // Validate configuration on load (fail-fast)
        function validateConfig() {
            if (!CONFIG.API.DEFAULT_HOST || !CONFIG.API.DEFAULT_PORT) {
                throw new Error('Invalid API configuration: host and port are required');
            }
            
            if (CONFIG.API.DEFAULT_PORT < 1 || CONFIG.API.DEFAULT_PORT > 65535) {
                throw new Error(`Invalid port: ${CONFIG.API.DEFAULT_PORT}. Must be between 1-65535`);
            }
            
            Object.values(CONFIG.TIMEOUTS).forEach((timeout, index) => {
                if (timeout <= 0) {
                    throw new Error(`Invalid timeout configuration at index ${index}: ${timeout}`);
                }
            });
        }
        
        // Build URLs from configuration
        function buildApiUrl() {
            return `http://${CONFIG.API.DEFAULT_HOST}:${CONFIG.API.DEFAULT_PORT}${CONFIG.API.BASE_PATH}`;
        }
        
        function buildWebSocketUrl() {
            return `ws://${CONFIG.API.DEFAULT_HOST}:${CONFIG.API.DEFAULT_PORT}${CONFIG.API.WS_PATH}`;
        }
        
        // Validate configuration immediately (fail-fast principle)
        validateConfig();
        
        // Global variables
        let currentUser = null;
        let currentChat = null;
        let firebaseUsers = [];
        let mockUsers = [];
        let chats = [];
        let ws = null;
        let currentCategory = 'all';
        
        // API base URL - Single source of truth
        const API_BASE = buildApiUrl();
        
        // Initialize the application
        async function init() {
            await checkSystemStatus();
            await loadAvailableTeams();  // Load teams and set current team
            await loadFirebaseUsers();
            await loadTeamMembers();  // Load team members specifically
            await loadMockUsers();
            await loadChats();
            connectWebSocket();
            setupEventListeners();
        }
        
        // Check system status
        async function checkSystemStatus() {
            try {
                // Check bot status using stats endpoint instead of health
                const botResponse = await fetch(`${API_BASE}/stats`);
                if (botResponse.ok) {
                    const stats = await botResponse.json();
                    if (stats.bot_integration_available) {
                        document.getElementById('botStatus').textContent = CONFIG.STATUS.ONLINE;
                        document.getElementById('botStatus').className = 'status-value online';
                    } else {
                        document.getElementById('botStatus').textContent = CONFIG.STATUS.OFFLINE;
                        document.getElementById('botStatus').className = 'status-value offline';
                    }
                } else {
                    document.getElementById('botStatus').textContent = CONFIG.STATUS.OFFLINE;
                    document.getElementById('botStatus').className = 'status-value offline';
                }
                
                // Check Firebase status
                const firebaseResponse = await fetch(`${API_BASE}/firebase/users`);
                if (firebaseResponse.ok) {
                    document.getElementById('firebaseStatus').textContent = CONFIG.STATUS.CONNECTED;
                    document.getElementById('firebaseStatus').className = 'status-value online';
                } else {
                    document.getElementById('firebaseStatus').textContent = CONFIG.STATUS.DISCONNECTED;
                    document.getElementById('firebaseStatus').className = 'status-value offline';
                }
            } catch (error) {
                console.error('Error checking system status:', error);
                document.getElementById('botStatus').textContent = CONFIG.STATUS.ERROR;
                document.getElementById('botStatus').className = 'status-value offline';
                document.getElementById('firebaseStatus').textContent = CONFIG.STATUS.ERROR;
                document.getElementById('firebaseStatus').className = 'status-value offline';
            }
        }
        
        // Load available teams
        async function loadAvailableTeams() {
            try {
                const response = await fetch(`${API_BASE}/teams`);
                if (response.ok) {
                    const data = await response.json();
                    const teamSelector = document.getElementById('teamSelector');
                    
                    // Clear existing options
                    teamSelector.innerHTML = '';
                    
                    // Add teams to selector
                    data.teams.forEach(team => {
                        const option = document.createElement('option');
                        option.value = team.id;
                        option.textContent = `${team.name} (${team.id})`;
                        if (team.id === data.current_team_id) {
                            option.selected = true;
                        }
                        teamSelector.appendChild(option);
                    });
                    
                    // Update current team display
                    document.getElementById('currentTeamId').textContent = data.current_team_id;
                    document.getElementById('teamSource').textContent = 'team_switcher';
                    
                } else {
                    console.error('Failed to load teams');
                    document.getElementById('teamSelector').innerHTML = '<option value="">Error loading teams</option>';
                }
            } catch (error) {
                console.error('Error loading teams:', error);
                document.getElementById('teamSelector').innerHTML = '<option value="">Connection failed</option>';
            }
        }
        
        // Switch team
        async function switchTeam(teamId) {
            try {
                console.log('Switching to team:', teamId);
                console.log('Switch URL:', `${API_BASE}/teams/switch`);
                
                const response = await fetch(`${API_BASE}/teams/switch`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ team_id: teamId })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log(`Switched to team: ${data.current_team_id}`);
                    
                    // Update UI
                    document.getElementById('currentTeamId').textContent = data.current_team_id;
                    document.getElementById('teamSource').textContent = 'team_switcher';
                    
                    // Reload users to reflect new team
                    await loadFirebaseUsers();
                    
                    // Also reload team members specifically
                    await loadTeamMembers();
                    
                    // Show success message
                    showNotification(`Switched to team ${data.current_team_id}`, 'success');
                } else {
                    console.error('Failed to switch team');
                    showNotification('Failed to switch team', 'error');
                }
            } catch (error) {
                console.error('Error switching team:', error);
                showNotification('Error switching team', 'error');
            }
        }
        
        // Load team ID information
        async function loadTeamInfo() {
            try {
                console.log('Loading team info from:', `${API_BASE}/team_id`);
                const response = await fetch(`${API_BASE}/team_id`);
                console.log('Team info response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Team info data:', data);
                    document.getElementById('currentTeamId').textContent = data.team_id;
                    document.getElementById('teamSource').textContent = data.source;
                } else {
                    console.error('Team info response not ok:', response.status, response.statusText);
                    document.getElementById('currentTeamId').textContent = 'Error';
                    document.getElementById('teamSource').textContent = 'Failed to load';
                }
            } catch (error) {
                console.error('Error loading team info:', error);
                document.getElementById('currentTeamId').textContent = 'Error';
                document.getElementById('teamSource').textContent = 'Connection failed';
            }
        }
        
        // Load Firebase users
        async function loadFirebaseUsers() {
            try {
                const response = await fetch(`${API_BASE}/firebase/users`);
                if (response.ok) {
                    const data = await response.json();
                    firebaseUsers = data.users || [];
                    
                    // Debug: Log user roles to understand what's being returned
                    console.log('🔍 Debug: User roles from Firebase:');
                    firebaseUsers.forEach(user => {
                        console.log(`  - ${user.first_name} ${user.last_name || ''}: role="${user.role}"`);
                    });
                    
                    const source = data.source || 'unknown';
                    let sourceText = 'Unknown Source';
                    let sourceClass = 'unknown';
                    
                    if (source === 'firestore') {
                        sourceText = 'Real Firestore Data';
                        sourceClass = 'firestore';
                    } else if (source === 'mock_fallback') {
                        sourceText = 'Mock Data (Firestore failed)';
                        sourceClass = 'mock-fallback';
                    } else if (source === 'mock_only') {
                        sourceText = 'Mock Data (No Firestore)';
                        sourceClass = 'mock-only';
                    } else if (source === 'error') {
                        sourceText = 'Error Loading Data';
                        sourceClass = 'error';
                    }
                    
                    document.getElementById('teamSource').textContent = sourceText;
                    document.getElementById('teamSource').className = `team-source ${sourceClass}`;
                    
                    console.log(`📊 Loaded ${firebaseUsers.length} users from ${sourceText}`);
                    
                    renderUsers();
                } else {
                    console.error('Failed to load Firebase users');
                    firebaseUsers = [];
                    document.getElementById('teamSource').textContent = 'Failed to load';
                    document.getElementById('teamSource').className = 'team-source error';
                    renderUsers(); // Render empty state
                }
            } catch (error) {
                console.error('Error loading Firebase users:', error);
                firebaseUsers = [];
                document.getElementById('teamSource').textContent = 'Connection error';
                document.getElementById('teamSource').className = 'team-source error';
                renderUsers(); // Render empty state
            }
        }
        
        // Load team members specifically
        async function loadTeamMembers() {
            try {
                const response = await fetch(`${API_BASE}/firebase/team_members`);
                if (response.ok) {
                    const data = await response.json();
                    console.log(`Loaded ${data.total} team members for team ${data.team_id}`);
                    
                    // Update team ID from response if available
                    if (data.team_id) {
                        document.getElementById('currentTeamId').textContent = data.team_id;
                        document.getElementById('teamSource').textContent = 'Team members response';
                    }
                } else {
                    console.error('Failed to load team members');
                }
            } catch (error) {
                console.error('Error loading team members:', error);
            }
        }
        
        // Load mock users
        async function loadMockUsers() {
            try {
                const response = await fetch(`${API_BASE}/users`);
                if (response.ok) {
                    const data = await response.json();
                    mockUsers = data.users || []; // Extract the users array from the response
                } else {
                    mockUsers = [];
                }
            } catch (error) {
                console.error('Error loading mock users:', error);
                mockUsers = [];
            }
        }
        
        // Load chats
        async function loadChats() {
            try {
                const response = await fetch(`${API_BASE}/chats`);
                if (response.ok) {
                    const data = await response.json();
                    chats = data.chats || data || []; // Handle both nested and direct array responses
                } else {
                    chats = [];
                }
            } catch (error) {
                console.error('Error loading chats:', error);
                chats = [];
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Category buttons
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCategory = btn.dataset.category;
                    renderUsers();
                });
            });
            
            // Chat tabs
            document.querySelectorAll('.chat-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.chat-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    selectChat(tab.dataset.chat);
                });
            });
            
            // Template buttons
            document.querySelectorAll('.template-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    runTestScenario(btn.dataset.scenario);
                });
            });
            
            // User search
            document.getElementById('userSearch').addEventListener('input', (e) => {
                filterUsers(e.target.value);
            });
            
            // Team switching
            document.getElementById('teamSelector').addEventListener('change', (e) => {
                const selectedTeamId = e.target.value;
                if (selectedTeamId) {
                    switchTeam(selectedTeamId);
                }
            });
            
            // User selection using event delegation (best practice)
            document.getElementById('userList').addEventListener('click', (e) => {
                const userItem = e.target.closest('.user-item');
                if (userItem) {
                    const telegramId = userItem.dataset.telegramId;
                    
                    // Find the user data from firebaseUsers
                    const user = firebaseUsers.find(u => u.id === telegramId);
                    if (user) {
                        selectUser(user);
                    }
                }
            });
            
            // Send button
            document.getElementById('sendButton').addEventListener('click', sendMessage);
            
            // Enter key in message input
            document.getElementById('messageInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Export and clear buttons
            document.getElementById('exportBtn').addEventListener('click', exportChat);
            document.getElementById('clearBtn').addEventListener('click', clearChat);
        }
        
        // Render users based on category and search
        function renderUsers() {
            const userList = document.getElementById('userList');
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            
            // Helper function to check if user is admin
            function isAdminUser(user) {
                const adminRoles = [
                    'admin', 'leadership', 
                    'club administrator', 'club_administrator',
                    'team manager', 'team_manager',
                    'coach', 'assistant coach', 'assistant_coach'
                ];
                return adminRoles.some(role => 
                    user.role && user.role.toLowerCase().includes(role.toLowerCase())
                );
            }
            
            // Helper function to check if user is a team member (non-player)
            function isTeamMember(user) {
                return user.role && user.role !== 'player';
            }
            
            // Debug: Log filtering process
            console.log(`🔍 Filtering users: category="${currentCategory}", search="${searchTerm}"`);
            console.log(`📊 Total users before filtering: ${firebaseUsers.length}`);
            
            // Filter users by category and search
            let filteredUsers = firebaseUsers.filter(user => {
                const matchesCategory = currentCategory === 'all' || 
                    (currentCategory === 'players' && user.role === 'player') ||
                    (currentCategory === 'team-members' && isTeamMember(user)) ||
                    (currentCategory === 'admins' && isAdminUser(user)); // Admins are team members with leadership access
                
                const fullName = `${user.first_name} ${user.last_name || ''}`.trim();
                const matchesSearch = fullName.toLowerCase().includes(searchTerm) ||
                    user.username?.toLowerCase().includes(searchTerm) ||
                    user.role?.toLowerCase().includes(searchTerm);
                
                // Debug: Log admin detection
                if (currentCategory === 'admins') {
                    const isTeamMemberUser = isTeamMember(user);
                    console.log(`  - ${fullName}: role="${user.role}", isTeamMember=${isTeamMemberUser}`);
                }
                
                return matchesCategory && matchesSearch;
            });
            
            console.log(`✅ Filtered users: ${filteredUsers.length} users match criteria`);
            
            userList.innerHTML = '';
            
            if (filteredUsers.length === 0) {
                userList.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: var(--text-secondary);">
                        No users found
                    </div>
                `;
                return;
            }
            
            filteredUsers.forEach(user => {
                const userElement = createUserElement(user);
                userList.appendChild(userElement);
            });
        }
        
        // Create user element
        function createUserElement(user) {
            const li = document.createElement('li');
            li.className = 'user-item';
            li.dataset.telegramId = user.id; // Use user.id as telegram_id
            li.dataset.userId = user.id; // Use user.id as user_id
            
            const fullName = `${user.first_name} ${user.last_name || ''}`.trim();
            const initials = fullName.split(' ').map(n => n[0]).join('').toUpperCase() || 'U';
            
            // Helper function to check if user is admin
            function isAdminUser(user) {
                const adminRoles = [
                    'admin', 'leadership', 
                    'club administrator', 'club_administrator',
                    'team manager', 'team_manager',
                    'coach', 'assistant coach', 'assistant_coach'
                ];
                return adminRoles.some(role => 
                    user.role && user.role.toLowerCase().includes(role.toLowerCase())
                );
            }
            
            const roleColor = user.role === 'player' ? 'var(--role-player)' : 
                            isAdminUser(user) ? 'var(--role-admin)' : 
                            'var(--role-member)';
            
            // Determine chat access based on role
            const hasMainChatAccess = true; // All users have main chat access
            const hasLeadershipChatAccess = user.role && user.role !== 'player'; // Team members (non-players) have leadership chat access
            
            // Debug: Log permission determination
            console.log(`🔍 User: ${fullName}, Role: ${user.role}, Main: ${hasMainChatAccess}, Leadership: ${hasLeadershipChatAccess}`);
            
            li.innerHTML = `
                <div class="user-avatar" style="background: ${roleColor}">
                    ${initials}
                </div>
                <div class="user-info">
                    <div class="user-name">${fullName}</div>
                    <div class="user-role">
                        <span>@${user.username}</span>
                        <span>•</span>
                        <span>${user.role}</span>
                    </div>
                    <div class="user-phone">${user.phone_number || 'No phone'}</div>
                </div>
                <div class="user-permissions">
                    ${hasMainChatAccess ? '<span class="permission-badge main-chat">Main Chat</span>' : ''}
                    ${hasLeadershipChatAccess ? '<span class="permission-badge leadership-chat">Leadership</span>' : ''}
                </div>
            `;
            
            return li;
        }
        
        // Filter users
        function filterUsers(searchTerm) {
            renderUsers();
        }
        
        // Select a user
        function selectUser(user) {
            currentUser = user;
            
            // Update UI - remove active class from all users
            document.querySelectorAll('.user-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to the clicked user
            const userElement = document.querySelector(`[data-telegram-id="${user.id}"]`);
            if (userElement) {
                userElement.classList.add('active');
            }
            
            // Enable message input
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            messageInput.disabled = false;
            sendButton.disabled = false;
            const fullName = `${user.first_name} ${user.last_name || ''}`.trim();
            messageInput.placeholder = `Send message as ${fullName}...`;
            
            // Update chat title to show selected user
            updateChatTitle();
            
            // Update chat tab availability based on user role
            updateChatTabAvailability(user);
            
            // If no chat is selected, select main chat
            if (!currentChat) {
                selectChat('main');
            }
        }
        
        // Update chat tab availability based on user role
        function updateChatTabAvailability(user) {
            const leadershipTab = document.querySelector('.chat-tab[data-chat="leadership"]');
            const mainTab = document.querySelector('.chat-tab[data-chat="main"]');
            
            // All users can access main chat
            if (mainTab) {
                mainTab.disabled = false;
                mainTab.classList.remove('disabled');
            }
            
            // Only team members (non-players) can access leadership chat
            const hasLeadershipAccess = user.role && user.role !== 'player';
            if (leadershipTab) {
                if (hasLeadershipAccess) {
                    leadershipTab.disabled = false;
                    leadershipTab.classList.remove('disabled');
                    leadershipTab.title = 'Leadership chat for team members and admins';
                } else {
                    leadershipTab.disabled = true;
                    leadershipTab.classList.add('disabled');
                    leadershipTab.title = 'Access denied: Only team members can access leadership chat';
                }
            }
        }
        
        // Update chat title based on current selection
        function updateChatTitle() {
            const chatTitle = document.getElementById('chatTitle');
            if (currentUser && currentChat) {
                let chatType = '';
                if (currentChat.is_main_chat) {
                    chatType = 'Main Chat';
                } else if (currentChat.is_leadership_chat) {
                    chatType = 'Leadership';
                } else {
                    chatType = 'Private';
                }
                const fullName = `${currentUser.first_name} ${currentUser.last_name || ''}`.trim();
                chatTitle.textContent = `Chat with ${fullName} (${chatType})`;
            } else if (currentUser) {
                const fullName = `${currentUser.first_name} ${currentUser.last_name || ''}`.trim();
                chatTitle.textContent = `Select a chat for ${fullName}`;
            } else {
                chatTitle.textContent = 'Select a user to start chatting';
            }
        }
        
        // Select a chat
        function selectChat(chatType) {
            const chat = chats.find(c => {
                if (chatType === 'main') return c.is_main_chat;
                if (chatType === 'leadership') return c.is_leadership_chat;
                return false;
            });
            
            if (!chat) {
                console.warn('No chat found for type:', chatType);
                return;
            }
            
            currentChat = chat;
            
            // Update chat title
            updateChatTitle();
            
            // Update chat description
            let chatDescription = '';
            let chatPermissions = '';
            
            if (chat.is_main_chat) {
                chatDescription = 'Main team chat for all players';
                chatPermissions = 'All users can send messages';
            } else if (chat.is_leadership_chat) {
                chatDescription = 'Leadership chat for team members and admins';
                chatPermissions = 'Team members and admins only';
            }
            
            const descriptionElement = document.querySelector('.chat-description');
            const permissionsElement = document.querySelector('.chat-permissions');
            
            if (descriptionElement) descriptionElement.textContent = chatDescription;
            if (permissionsElement) permissionsElement.textContent = chatPermissions;
            
            // Load chat history
            loadChatHistory(chat.id);
        }
        
        // Load chat history
        async function loadChatHistory(chatId) {
            try {
                const response = await fetch(`${API_BASE}/chats/${chatId}/messages`);
                if (response.ok) {
                    const messages = await response.json();
                    
                    const chatMessages = document.getElementById('chatMessages');
                    chatMessages.innerHTML = '';
                    
                    messages.forEach(message => {
                        addMessageToChat(message);
                    });
                    
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            } catch (error) {
                console.error('Error loading chat history:', error);
            }
        }
        
        // Send a message
        async function sendMessage() {
            if (!currentUser || !currentChat) {
                alert('Please select a user and chat first');
                return;
            }
            
            // Check if user has access to the selected chat
            const hasMainChatAccess = true; // All users have main chat access
            const hasLeadershipChatAccess = currentUser.role && currentUser.role !== 'player'; // Team members have leadership chat access
            
            if (currentChat.is_leadership_chat && !hasLeadershipChatAccess) {
                alert('Access Denied: This user does not have access to the leadership chat. Only team members can access the leadership chat.');
                return;
            }
            
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            // Convert user ID properly - handle both string and integer IDs
            let userId;
            if (typeof currentUser.id === 'string') {
                // Handle Firebase string IDs like "user_1001" -> extract 1001
                if (currentUser.id.startsWith('user_')) {
                    userId = parseInt(currentUser.id.replace('user_', ''));
                } else {
                    userId = parseInt(currentUser.id);
                }
            } else {
                userId = currentUser.id;
            }
            
            // Validate the converted user ID
            if (isNaN(userId) || userId <= 0) {
                alert('Error: Invalid user ID. Please select a valid user.');
                return;
            }
            
            console.log(`🔍 Debug: Converting user ID from "${currentUser.id}" (${typeof currentUser.id}) to ${userId} (${typeof userId})`);
            
            const messageData = {
                user_id: userId,
                chat_id: currentChat.id,
                text: text
            };
            
            console.log(`📤 Sending message data:`, messageData);
            
            try {
                const response = await fetch(`${API_BASE}/send_message`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(messageData)
                });
                
                if (response.ok) {
                    input.value = '';
                } else {
                    const errorData = await response.json();
                    console.error('Error sending message:', errorData);
                    
                    // Extract error message properly
                    let errorMessage = 'Failed to send message';
                    if (errorData.detail) {
                        errorMessage = errorData.detail;
                    } else if (errorData.error) {
                        errorMessage = errorData.error;
                    } else if (typeof errorData === 'string') {
                        errorMessage = errorData;
                    } else if (errorData.message) {
                        errorMessage = errorData.message;
                    }
                    
                    alert(`Error: ${errorMessage}`);
                }
            } catch (error) {
                console.error('Error sending message:', error);
                alert('Failed to send message. Please try again.');
            }
        }
        

        
        // Run test scenario
        function runTestScenario(scenario) {
            if (!currentUser) {
                alert('Please select a user first');
                return;
            }
            
            // Check if user has appropriate permissions for the scenario
            const userRole = currentUser.role;
            const isTeamMember = userRole && userRole !== 'player';
            
            const scenarios = {
                'player-registration': {
                    command: '/addplayer New Player +447700900000 Forward',
                    description: 'Register a new player with name, phone, and position',
                    requiresLeadership: true,
                    chatType: 'leadership'
                },
                'match-creation': {
                    command: '/creatematch Weekend Match 2024-12-15 14:00 Home',
                    description: 'Create a new match with date, time, and venue',
                    requiresLeadership: true,
                    chatType: 'leadership'
                },
                'attendance-marking': {
                    command: '/markattendance MATCH001 present',
                    description: 'Mark attendance for a specific match',
                    requiresLeadership: false,
                    chatType: 'main'
                }
            };
            
            const scenarioData = scenarios[scenario];
            if (!scenarioData) {
                alert('Unknown scenario');
                return;
            }
            
            // Check permissions
            if (scenarioData.requiresLeadership && !isTeamMember) {
                alert(`This scenario requires leadership access. Current user role: ${userRole}`);
                return;
            }
            
            // Set the message and switch to appropriate chat
            const messageInput = document.getElementById('messageInput');
            messageInput.value = scenarioData.command;
            
            // Switch to appropriate chat type if needed
            if (scenarioData.chatType === 'leadership' && currentChat && !currentChat.is_leadership_chat) {
                // Try to switch to leadership chat
                const leadershipTab = document.querySelector('.chat-tab[data-chat="leadership"]');
                if (leadershipTab && !leadershipTab.disabled) {
                    leadershipTab.click();
                } else {
                    alert('Leadership chat access required for this scenario');
                    return;
                }
            } else if (scenarioData.chatType === 'main' && currentChat && !currentChat.is_main_chat) {
                // Switch to main chat
                const mainTab = document.querySelector('.chat-tab[data-chat="main"]');
                if (mainTab) {
                    mainTab.click();
                }
            }
            
            // Show scenario info
            console.log(`🚀 Running scenario: ${scenario}`);
            console.log(`📝 Command: ${scenarioData.command}`);
            console.log(`📋 Description: ${scenarioData.description}`);
            console.log(`👤 User: ${currentUser.first_name} (${currentUser.role})`);
            console.log(`💬 Chat: ${currentChat ? (currentChat.is_leadership_chat ? 'Leadership' : 'Main') : 'None'}`);
            
            // Send the message
            sendMessage();
        }
        
        // Export chat
        function exportChat() {
            const chatMessages = document.getElementById('chatMessages');
            const messages = Array.from(chatMessages.children).map(msg => {
                const info = msg.querySelector('.message-info').textContent;
                const text = msg.textContent.replace(info, '').trim();
                return `${info}: ${text}`;
            });
            
            const blob = new Blob([messages.join('\n')], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `chat-export-${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Clear chat
        function clearChat() {
            if (confirm('Are you sure you want to clear the chat?')) {
                document.getElementById('chatMessages').innerHTML = '';
            }
        }
        
        // Connect to WebSocket with fail-fast validation
        function connectWebSocket() {
            const wsUrl = buildWebSocketUrl();
            
            try {
                ws = new WebSocket(wsUrl);
                
                // Set timeout for connection
                const connectTimeout = setTimeout(() => {
                    if (ws.readyState === WebSocket.CONNECTING) {
                        ws.close();
                        console.error(`WebSocket connection timeout after ${CONFIG.TIMEOUTS.WS_CONNECT}ms`);
                    }
                }, CONFIG.TIMEOUTS.WS_CONNECT);
                
                ws.onopen = function() {
                    clearTimeout(connectTimeout);
                    console.log(`WebSocket connected to ${wsUrl}`);
                };
                
                ws.onclose = function() {
                    clearTimeout(connectTimeout);
                    // WebSocket disconnected, attempt reconnection
                    setTimeout(connectWebSocket, CONFIG.TIMEOUTS.WS_RECONNECT);
                };
                
                ws.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        handleWebSocketMessage(data);
                    } catch (error) {
                        console.error('Error parsing WebSocket message:', error);
                    }
                };
                
                ws.onerror = function(error) {
                    clearTimeout(connectTimeout);
                    console.error('WebSocket error:', error);
                };
                
            } catch (error) {
                console.error('Failed to create WebSocket connection:', error);
                // Retry after timeout
                setTimeout(connectWebSocket, CONFIG.TIMEOUTS.WS_RECONNECT);
            }
        }
        
        // Handle WebSocket messages
        function handleWebSocketMessage(data) {
            try {
                if (data.type === 'new_message') {
                    addMessageToChat(data.message);
                } else if (data.type === 'bot_response') {
                    addBotMessageToChat(data.message);
                }
            } catch (error) {
                console.error('Error handling WebSocket message:', error);
            }
        }
        
        // Add a user message to the chat
        function addMessageToChat(message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            
            const time = new Date(message.date * 1000).toLocaleTimeString();
            messageDiv.innerHTML = `
                <div class="message-info">${message.from.first_name} • ${time}</div>
                ${message.text}
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Add a bot message to the chat
        function addBotMessageToChat(message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            let time = 'Now';
            if (message.date) {
                try {
                    const date = new Date(message.date * 1000);
                    if (!isNaN(date.getTime())) {
                        time = date.toLocaleTimeString();
                    }
                } catch (error) {
                    console.warn('Error formatting bot message date:', error);
                }
            }
            
            // Handle different message formats
            let messageText = '';
            if (typeof message === 'string') {
                messageText = message;
            } else if (message && typeof message === 'object') {
                // Handle AgentResponse objects
                if (message.message && message.success !== undefined) {
                    messageText = message.message;
                } else if (message.text) {
                    messageText = message.text;
                } else {
                    messageText = JSON.stringify(message);
                }
            } else {
                messageText = 'No response text';
            }
            
            // Format the message text for better display
            messageText = formatMessageText(messageText);
            
            messageDiv.innerHTML = `
                <div class="message-info">🤖 KickAI Bot • ${time}</div>
                <div class="message-content">${messageText}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Format message text for better display
        function formatMessageText(text) {
            if (!text) return '';
            
            // Escape HTML entities to prevent injection and display issues
            text = text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
            
            // Convert line breaks to HTML
            text = text.replace(/\n/g, '<br>');
            
            // Highlight emojis and make them larger
            text = text.replace(/([👤👥📋🔑🎭🏢📱📧📅🔄✅⏳🔴❌❓💡📞🤖⚽🏷️])/g, 
                '<span style="font-size: 1.2em; margin: 0 2px;">$1</span>');
            
            // Highlight command-like text
            text = text.replace(/(\/[a-zA-Z]+)/g, '<code style="background: #f0f0f0; padding: 2px 4px; border-radius: 3px; font-family: monospace;">$1</code>');
            
            return text;
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Add notification styles if not already present
        if (!document.querySelector('#notification-styles')) {
            const style = document.createElement('style');
            style.id = 'notification-styles';
            style.textContent = `
                .notification {
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 12px 16px;
                    border-radius: 6px;
                    color: white;
                    font-weight: 500;
                    z-index: 1000;
                    animation: slideIn 0.3s ease-out;
                }
                
                .notification.success {
                    background: var(--primary-green);
                }
                
                .notification.error {
                    background: var(--primary-red);
                }
                
                .notification.info {
                    background: var(--primary-blue);
                }
                
                @keyframes slideIn {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html> 